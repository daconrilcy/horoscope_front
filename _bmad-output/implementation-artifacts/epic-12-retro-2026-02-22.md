# Epic 12 Retrospective ‚Äî Profil natal : saisie des donn√©es et g√©n√©ration du th√®me

**Date :** 2026-02-22  
**Participants :** √âquipe de d√©veloppement (Dev Agents + Cyril)  
**FRs couverts :** FR10, FR11, FR14

---

## R√©sum√© de l'Epic

L'Epic 12 a permis de compl√©ter le parcours utilisateur pour la saisie des donn√©es de naissance et la g√©n√©ration du th√®me natal depuis le frontend. Deux stories ont √©t√© impl√©ment√©es :

- **Story 12.1** : Formulaire de saisie du profil natal (BirthProfilePage)
- **Story 12.2** : D√©clenchement et feedback de la g√©n√©ration du th√®me natal depuis l'UI

---

## Ce qui a bien fonctionn√© ‚úÖ

### 1. Co-impl√©mentation efficace des stories 12.1 et 12.2
La g√©n√©ration du th√®me natal (12.2) a √©t√© co-impl√©ment√©e dans `BirthProfilePage.tsx` lors de 12.1, permettant un flux utilisateur coh√©rent d√®s le d√©part.

### 2. Pattern RHF + Zod solide
L'utilisation de React Hook Form avec Zod pour la validation client-side a prouv√© son efficacit√© :
- Validation inline avec `aria-invalid` et `aria-describedby` (WCAG 2.1 AA)
- Gestion des erreurs API avec `setError()` pour les cas sp√©cifiques (invalid_birth_time, invalid_timezone)

### 3. Gestion robuste du cache TanStack Query
L'invalidation du cache `["birth-profile"]` apr√®s sauvegarde et l'optimisation via `setQueryData` pour la redirection post-g√©n√©ration ont offert une UX fluide.

### 4. Architecture de navigation refactoris√©e
Le refactor vers un pattern switch-based dans `App.tsx` avec prop `onNavigate` a √©limin√© les remontages de composants lors des refreshs de profil.

---

## Ce qui peut √™tre am√©lior√© ‚ö†Ô∏è

### 1. Contrainte backend non document√©e dans l'epic
Le champ `birth_time` √©tait d√©crit comme "optionnel" dans l'epic mais le backend exigeait `min_length=5`. Cela a caus√© une confusion initiale ‚Äî le sch√©ma Zod a d√ª valider le champ comme requis.

**Action :** Documenter explicitement les contraintes backend dans les stories, ou cr√©er un ticket backend pour aligner le comportement.

### 2. Scope creep entre stories
La story 12.2 a √©t√© largement co-impl√©ment√©e dans 12.1, ce qui a brouill√© les limites de chaque story. Les Completion Notes ont d√ª √™tre mises √† jour apr√®s code review pour refl√©ter cette r√©alit√©.

**Action :** Lors de la planification, identifier les co-d√©pendances et d√©cider explicitement si les stories doivent √™tre fusionn√©es ou s√©par√©es.

### 3. Tests manquants d√©couverts en code review
Plusieurs tests AC (invalid_timezone, bouton r√©-activ√©) √©taient marqu√©s `[x]` mais absents du code. Les code reviews adversariales ont rattrap√© ces lacunes.

**Action :** Imposer une v√©rification automatique "task checkbox ‚Üí test exists" avant de marquer done.

---

## Le√ßons apprises üìö

| Le√ßon | Recommandation |
|-------|----------------|
| La co-impl√©mentation cross-story peut √™tre efficace si document√©e | Mettre √† jour les File Lists et Completion Notes imm√©diatement |
| Les code reviews adversariales (Gemini + Claude) d√©tectent les incoh√©rences | Conserver le pattern multi-LLM pour les reviews critiques |
| `onChange` doit nettoyer tous les √©tats d'erreur associ√©s | Pattern √† documenter dans les conventions frontend |
| La regex timezone doit accepter UTC/GMT sans slash | Tester les timezones IANA edge cases syst√©matiquement |

---

## M√©triques

| M√©trique | Valeur |
|----------|--------|
| Stories compl√©t√©es | 2/2 (100%) |
| Tests ajout√©s | 18 dans BirthProfilePage.test.tsx |
| Rounds de code review | 5 (story 12.1) + 6 (story 12.2) |
| Bugs corrig√©s en review | 11 (6 HIGH/MEDIUM, 5 LOW) |
| Lint errors final | 0 |

---

## Actions pour les prochains sprints

1. [ ] **Aligner epic/PRD avec les contraintes backend r√©elles** ‚Äî Documenter les validations Pydantic dans les AC
2. [ ] **Template de v√©rification AC-to-tests** ‚Äî Script ou checklist pour valider que chaque AC a un test correspondant
3. [ ] **Guide co-impl√©mentation** ‚Äî Documenter le pattern quand deux stories partagent le m√™me composant

---

**Status :** Epic 12 ‚úÖ Done
