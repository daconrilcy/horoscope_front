# Rétrospective Epic 17 — Fondations UI, Page Aujourd'hui Premium

**Date :** 2026-02-24
**Epic :** 17 — Fondations UI, Page Aujourd'hui Premium
**Facilité par :** Bob (Scrum Master)
**Participants :** Cyril (Project Lead), Alice (PO), Charlie (Senior Dev), Dana (QA), Elena (Junior Dev)

---

## RÉSUMÉ EPIC 17

### Métriques de livraison

| Métrique | Valeur |
|----------|--------|
| Stories complétées | 13/13 (100%) |
| Stories fondations | 8 (17-1 → 17-8) |
| Stories correctifs | 5 (17-9 → 17-13) soit **38%** de l'epic |
| Tests | 981/981 passants (100%) |
| Régressions | 0 |
| Cycles de code review max | 21 (story 17-2) |
| Composants UI créés | 8 |
| Tokens CSS | 26 variables (21 base + 5 badges) |
| Langues | FR / EN / ES |
| Tests E2E Playwright | 2/2 ✅ |
| Incidents prod | 0 |

### Objectifs atteints

- Page Aujourd'hui premium conforme maquettes Light Pastel + Dark Cosmic ✅
- Système de tokens CSS centralisé (theme.css) ✅
- Navigation Bottom Nav glass pill mobile-first ✅
- WCAG 2.1 AA sur tous les composants ✅
- Visual smoke tests + Playwright E2E ✅
- Support i18n réactif FR/EN/ES ✅

---

## CE QUI A BIEN MARCHÉ

1. **Architecture tokens dès le départ** — La séparation `theme.css` (tokens) vs. `backgrounds.css` (effets visuels) décidée en story 17-1 a tenu tout l'epic sans conflits.

2. **Résultat visuel conforme aux maquettes** — On s'est approché du style des maquettes light/dark. C'est l'objectif principal, livré.

3. **981 tests, zéro régression** — Sur un epic UI de cette complexité, c'est une vraie réussite.

4. **i18n réactif** — `useAstrologyLabels()` + `i18n/insights.ts` : traductions FR/EN/ES sans reload, pattern réutilisable.

5. **ThemeProvider robuste** — localStorage + `prefers-color-scheme` + `useThemeSafe` hook : architecture solide.

6. **Visual smoke tests + Playwright** — Actifs durables pour les prochains epics UI.

7. **Single source of truth navigation** — Unification `ui/nav.ts` en story 17-7 : pattern propre.

---

## DÉFIS ET CHALLENGES

### 1. Ratio correctifs élevé (38%)

5 stories sur 13 existaient uniquement pour corriger des écarts entre l'implémentation initiale et les maquettes. Root cause : des détails oubliés à l'implémentation (variables hardcodées, valeurs CSS incorrectes, logique erronée), non détectés jusqu'à une comparaison visuelle tardive (story 17-9).

**Exemples concrets :**
- `opacity: 0.85` hardcodé au lieu de `var(--text-2)`
- Constellation SVG en Bezier au lieu de lignes droites (spec non respectée)
- Breakpoints arbitraires (480px) au lieu des valeurs spec (280px)
- Toggle theme ajouté en 17-9, supprimé en 17-11 (aller-retour inutile)

### 2. Cycles de review infinis sans critère de sortie

Jusqu'à 21 cycles de code review sur une seule story. Chaque passe trouvait de nouvelles issues, sans mécanisme clair pour clore la review. Certaines sessions se terminaient sans certitude que toutes les issues étaient résolues.

**Impact :** Review fatigue, stories "finies à peu près", issues ouvertes qui ressortaient en correctifs.

### 3. Difficulté de traduction maquette → code

Les maquettes montrent un résultat visuel ; elles ne spécifient pas `backdrop-filter: blur(14px)` ou `rgba(255,255,255,0.55)`. Ce travail de traduction est une compétence à part entière. Sans guidelines structurés, les détails étaient devinés — et souvent incorrects dans les détails.

**Note :** Les Dev Notes contenaient les specs détaillées dans la plupart des stories, mais leur format narratif rendait difficile la vérification systématique point par point à l'implémentation.

### 4. Validation visuelle trop tardive

La validation pixel-perfect (Playwright E2E, visual smoke tests) n'est arrivée qu'en story 17-9, après 8 stories déjà livrées. Les écarts auraient pu être détectés dès la story 17-1.

---

## ANALYSE ROOT CAUSE

> **La spec était présente dans les Dev Notes, mais il n'existait pas de mécanisme pour vérifier chaque point à l'implémentation, ni de critère clair pour clore une code review.**

Les deux patterns se renforcent : une implémentation avec des détails oubliés génère plus d'issues en review ; des reviews sans fin claire laissent des issues ouvertes qui ressortent en correctifs.

---

## ACTION ITEMS

### Améliorations Process

**1. Créer un guide "Maquette → Code" pour les epics UI**
- Description : Checklist de traduction visuelle — comment extraire les valeurs exactes d'une maquette (blur, opacité, radius, couleurs, spacing) et les documenter en story Dev Notes
- Owner : Bob (SM) + Cyril
- Output : `docs/guidelines/mockup-to-code.md`
- Succès : Utilisé dès la première story du prochain epic UI

**2. Définir un critère de clôture pour les code reviews**
- Description : Une review est "done" quand toutes les issues sont cochées ✅ dans le story file. Si une issue ne peut pas être résolue, elle est documentée explicitement avec décision (defer/fix/accept)
- Owner : Bob (SM)
- Succès : Plus de story clôturée avec issues ouvertes implicites

**3. Visual validation dès story 1**
- Description : Intégrer un test de smoke visuel CSS dès la première story d'un epic UI — vérifiant tokens actifs et absence de valeurs hardcodées
- Owner : Amelia (Dev)
- Succès : Écarts détectés dans la même story, pas dans une story correctif ultérieure

### Team Agreements

- **Token-first** : Aucune couleur, opacité ou taille hardcodée — toujours `var(--...)`. Violation = review bloquante.
- **Spec checklist** : Chaque composant UI a une mini-checklist dans ses Dev Notes (format `[ ] blur: 14px`, `[ ] radius: 999px`) cochée à l'implémentation.
- **Review scope** : Une review couvre les issues de la session courante uniquement — pas d'expansion de scope sans accord explicite.

---

## READINESS ASSESSMENT EPIC 17

| Dimension | Statut | Notes |
|-----------|--------|-------|
| Tests | ✅ 981/981 | |
| Régressions | ✅ 0 | |
| Déploiement | ⏳ En attente | Vérification style manuelle requise avant déploiement |
| Stakeholders | ⏳ Après déploiement | |
| Codebase | ✅ Stable | Refactorisable (non-bloquant) |
| Blockers | ✅ Aucun | |

### Critical Path avant déploiement

1. **Vérification style manuelle** — Cyril compare rendu réel vs. maquettes (possible story 17-14 si écarts trouvés)
2. **Déploiement Epic 17** — conditionné à la vérification style

### Dette technique non-bloquante

- Refactoring CSS possible (composants modifiés 4-5 fois sur l'epic, potentiels doublons)
- À adresser lors du prochain epic UI

---

## PROCHAINES ÉTAPES

1. Vérification style manuelle avant déploiement (Cyril)
2. Déploiement Epic 17 si validation OK
3. Créer `docs/guidelines/mockup-to-code.md` (action item #1)
4. Appliquer les team agreements dès le prochain epic UI

---

## MOT DE CLÔTURE

> *"On ca finir par y arriver !"* — Cyril (Project Lead)

Epic 17 a livré une expérience premium conforme aux maquettes, avec une architecture CSS solide et 0 régression. Les leçons tirées — token-first, validation visuelle précoce, critères de review clairs — posent les bases d'un processus plus efficace pour les prochains epics UI.
