---
title: FE-13 — Billing config awareness & dev debug panel
labels: frontend, billing, stripe, priority:high
assignees:
  -
created: 2025-11-03
---

# FE-13 — Billing config awareness & dev debug panel

## Contexte

Lire et exposer côté front l’état de la configuration Billing (flags Trials/Coupons/Tax, URLs de retour, base URL publique) avec un panneau dev-only.

## Objectif

- Mettre en œuvre billing config awareness & dev debug panel pour aligner le front sur l'API backend Stripe.
- Offrir une UX claire, résiliente et testable.

## Portée / Hors-périmètre

- **Dans le scope** : Billing config awareness & dev debug panel.
- **Hors scope** : pricing logic côté backend, routes Stripe Server/webhooks (déjà gérées au backend).

## Design & Implémentation

- Dossier(s) impactés: `src/services/billing/*`, `src/components/billing/*`, `src/pages/billing/*`, `src/routes/*` (à adapter).
- Tech: React + TS, Zustand (si store), Zod pour validation, MSW pour tests.

### Tâches de dev

- [ ] Créer `BillingConfigService.get()` qui lit `/v1/config` (si dispo) ou `import.meta.env`.
- [ ] Exposer `PUBLIC_BASE_URL`, `BILLING_CHECKOUT_SUCCESS_PATH`, `BILLING_CHECKOUT_CANCEL_PATH`,
      `CHECKOUT_TRIALS_ENABLED`, `CHECKOUT_COUPONS_ENABLED`, `STRIPE_TAX_ENABLED`.
- [ ] Ajouter un **Billing Debug Panel** (visible uniquement en dev) qui liste les flags et avertit si l’origin front ne matche pas la base URL de retour.
- [ ] Ajout d’un badge d’environnement (dev/prod) dans le panel.

### Accessibilité & i18n

- Labels et descriptions accessibles (ARIA si modal).
- Texte FR prêt pour i18n.

### Observabilité

- Logger `request_id` (si header) dans un EventBus local (dev-only) pour corrélation.

## Tests

**Unit (Vitest)**

- [ ] Mapping env → modèle interne (toutes combinaisons de flags).
- [ ] Rendu des warnings selon URLs de retour/origin.

**E2E (Playwright)**

- [ ] Le panneau apparaît en dev, masqué en prod.
- [ ] Les badges reflètent bien les flags.

## Critères d’acceptation (AC)

- Le panneau dev affiche correctement les flags et un avertissement si mismatch d’URL.
- Aucun rendu de ce panneau en production (build).

## Sécurité

- Idempotency-Key générée côté front pour toutes mutations.
- Ne jamais exposer de clés secrètes Stripe (utiliser les endpoints backend).

## Risques / Mitigations

- Erreurs de whitelist d’URL retour: message explicite + fallback configuré.
- Flags désactivés: champs masqués proprement.

## PR attendue

**Title**: feat(front-billing): config awareness + dev panel  
**Body** (exemple à adapter) :

```
feat(front-billing): config awareness + dev panel

Contexte
- Implémente FE-13: Billing config awareness & dev debug panel.
- Aligne le front avec les endpoints backend Stripe.

Changements principaux
- [x] Composants/Service
- [x] Validation Zod
- [x] Feature flags respectés

Tests
- Unitaires (Vitest)
- MSW
- E2E (Playwright)

Docs
- README front mis à jour si applicable

Closes: <numéro de l'issue>
```

**Checklist PR**

- [ ] Lint/Typecheck ok
- [ ] Tests unitaires ok
- [ ] E2E scénarios clés ok (local)
- [ ] Docs mises à jour
- [ ] Pas d’infos sensibles dans les logs

## Références

- CONFIGURATION.md (base URLs, flags)
